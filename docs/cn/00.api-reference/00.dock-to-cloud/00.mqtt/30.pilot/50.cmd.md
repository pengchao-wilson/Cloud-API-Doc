 # Event

## 飞行器数据格式化进度

**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** drone_format

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|
|output|输出|struct|  ||
|»status|任务状态|enum_string| {"canceled":"取消或终止","failed":"失败","in_progress":"执行中","ok":"执行成功","paused":"暂停","rejected":"拒绝","sent":"已下发","timeout":"超时"} ||
|»progress|进度|struct|  ||
|»»percent|进度百分比|int| {"max":"100","min":"0","step":"1","unit_name":"百分比 / %"} ||
|»»step_key|当前步骤|enum_string| {"format_drone":"格式化飞行器数据"} ||
|need_reply|是否需要回复|enum_int|{"0":"不需要","1":"需要"} ||


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"output": {
			"progress": {
				"percent": 80,
				"step_key": "format_drone"
			},
			"status": "in_progress"
		},
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "drone_format",
	"need_reply": 0
}
```

## flyto 执行结果事件通知



**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** fly_to_point_progress

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|fly_to_id|飞向目标点 ID|text|  ||
|status|状态|enum_string| {"wayline_cancel":"取消飞向目标点","wayline_failed":"执行失败","wayline_ok":"执行成功，已飞向目标点","wayline_progress":"执行中"} ||
|result|返回码|int|  |非 0 代表错误|
|way_point_index|当前执行到第几个航点|int|  ||
|remaining_distance|剩余任务距离|float| {"step":0.1,"unit_name":"米 / m"} ||
|remaining_time|剩余任务时间|float| {"step":0.1,"unit_name":"秒 / s"} ||
|planned_path_points|规划的轨迹点列表|array|  {"size": -, "item_type": struct}  ||
|»latitude|轨迹点纬度|double| {"max":90,"min":-90} |轨迹点纬度，角度值，南纬是负，北纬是正，精度到小数点后6位|
|»longitude|轨迹点经度|double| {"max":180,"min":-180} |轨迹点经度，角度值，东经是正，西经是负，精度到小数点后6位|
|»height|轨迹点高度|float| {"step":0.1,"unit_name":"米 / m"} |轨迹点高度，椭球高|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"fly_to_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
		"planned_path_points": [
			{
				"height": 123.234,
				"latitude": 13.23,
				"longitude": 123.234
			}
		],
		"remaining_distance": 0,
		"remaining_time": 0,
		"result": 0,
		"status": "wayline_progress",
		"way_point_index": 0
	},
	"need_reply": 1,
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 16540709686556,
	"method": "fly_to_point_progress"
}
```


 # Service

## 飞行器数据格式化


**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** drone_format

**Data:** null 


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "drone_format"
}
```


**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** drone_format

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|
|output|输出|struct|  ||
|»status|任务状态|enum_string| {"canceled":"取消或终止","failed":"失败","in_progress":"执行中","ok":"执行成功","paused":"暂停","rejected":"拒绝","sent":"已下发","timeout":"超时"} ||

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0,
		"output": {
			"status": "in_progress"
		}
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "drone_format"
}
```


## 一键起飞

起飞到1米悬停。

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** takeoff_to_point

**Data:** null


**Example:**
```json
{
    "bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
    "data": {},
    "tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
    "timestamp": 1654070968655
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** takeoff_to_point

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "takeoff_to_point"
}
```


## flyto 飞向目标点

特别说明：飞行器有最低飞行高度(20m)安全保障机制，如果飞行器相对起飞点高度低于20m，会先上升到20m

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** fly_to_point

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|fly_to_id|飞向目标点 ID|text|  ||
|max_speed|flyto 的飞行过程中能达到的最大速度|int| {"max":15,"min":0,"unit_name":"米每秒 / m/s"} ||
|points|flyto 目标点列表|array|  {"size": -, "item_type": struct}  |仅支持 1 个目标点|
|»latitude|目标点纬度|double| {"max":90,"min":-90} |目标点纬度，角度值，南纬是负，北纬是正，精度到小数点后6位|
|»longitude|目标点经度|double| {"max":180,"min":-180} |目标点经度，角度值，东经是正，西经是负，精度到小数点后6位|
|»height|目标点高度|float| {"max":10000,"min":2,"step":0.1,"unit_name":"米 / m"} |目标点高度（椭球高），使用 WGS84 模型|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"fly_to_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
		"max_speed": 12,
		"points": [
			{
				"height": 100,
				"latitude": 12.23,
				"longitude": 12.23
			}
		]
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** fly_to_point

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point"
}
```


## 结束 flyto 飞向目标点任务

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** fly_to_point_stop

**Data:** null 



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point_stop"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** fly_to_point_stop

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point_stop"
}
```


## 更新 flyto 目标点

「一键起飞」或「flyto 飞向目标点」的过程中，可以通过该命令快速更新目标点

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** fly_to_point_update

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|max_speed|指令飞行过程中能达到的最大速度|int| {"max":15,"min":1,"unit_name":"米每秒 / m/s"} ||
|points|更新的目标点列表|array|  {"size": -, "item_type": struct}  |仅支持 1 个目标点|
|»latitude|目标点纬度|double| {"max":90,"min":-90} |目标点纬度，角度值，南纬是负，北纬是正，精度到小数点后6位|
|»longitude|目标点经度|double| {"max":180,"min":-180} |目标点经度，角度值，东经是正，西经是负，精度到小数点后6位|
|»height|目标点高度|float| {"max":10000,"min":2,"step":0.1,"unit_name":"米 / m"} |目标点高度（椭球高），使用 WGS84 模型|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"max_speed": 12,
		"points": [
			{
				"height": 100,
				"latitude": 12.23,
				"longitude": 12.23
			}
		]
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point_update"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** fly_to_point_update

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "fly_to_point_update"
}
```

## 负载控制—切换相机模式

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** camera_mode_switch

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|camera_mode|相机模式|enum_int| {"0":"拍照","1":"录像"} ||

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"camera_mode": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_mode_switch"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** camera_mode_switch

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_mode_switch"
}
```


## 负载控制—开始拍照

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** camera_photo_take

**Data:** null


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_photo_take"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** camera_photo_take

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|
|output|输出|struct|  ||
|»status|任务状态|enum_string| {"in_progress":"执行中"} |当全景拍照或其他持续性拍照行为时会上报状态信息，表达后续会有持续的进度事件上报，详细内容请查看 camera_photo_take_progress 事件|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_photo_take"
}
```


## 负载控制—开始录像

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** camera_recording_start

**Data:** null


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_recording_start"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** camera_recording_start

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_recording_start"
}
```


## 负载控制—停止录像

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** camera_recording_stop

**Data:** null


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_recording_stop"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** camera_recording_stop

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_recording_stop"
}
```

## 负载控制—变焦

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** camera_focal_length_set

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|camera_type|相机类型|enum_string| {"ir":"红外","wide":"广角","zoom":"变焦"} |相机类型枚举|
|zoom_factor|变焦倍数|double| {"max":200,"min":2} |变焦倍数，可见光是2-200，红外是2-20|

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"camera_type": "zoom",
		"zoom_factor": 5
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_focal_length_set"
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** camera_focal_length_set

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "camera_focal_length_set"
}
```




## 负载控制-云台角度控制

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** gimbal_angle_set

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|pitch|相机俯仰角度值|double| ||
|yaw|相机偏航角度值|double| ||

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"yaw": 0,
		"pitch": -30
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "gimbal_angle_set"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** gimbal_angle_set

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "gimbal_angle_set"
}
```


## 负载控制—重置云台


**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** gimbal_reset

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|reset_mode|重置模式类型|enum_int| {"0":"回中","1":"向下","2":"偏航回中","3":"俯仰向下"} ||


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"reset_mode": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "gimbal_reset"
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** gimbal_reset

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "gimbal_reset"
}
```



## 取消返航

返航后，飞行器会退出航线模式，此时取消返航，飞行器会悬停

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** return_home_cancel

**Data:** null 



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "return_home_cancel"
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** return_home_cancel

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"need_reply": 1,
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "return_home_cancel"
}
```


## 一键返航

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** return_home

**Data:** null 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "return_home"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** return_home

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|
|output|输出|struct|  ||
|»status|任务状态|enum_string| {"canceled":"取消或终止","failed":"失败","in_progress":"执行中","ok":"执行成功","paused":"暂停","rejected":"拒绝","sent":"已下发","timeout":"超时"} ||


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"need_reply": 0,
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "return_home"
}
```

