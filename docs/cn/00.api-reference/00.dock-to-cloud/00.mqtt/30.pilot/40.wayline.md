
 # Event

## 上报航线上传进度

**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** wayline_upload_progress

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|
|output|输出|struct| ||
|>status|任务状态|enum_string|{"canceled":"取消或终止","failed":"失败","in_progress":"执行中","ok":"执行成功","paused":"暂停","rejected":"拒绝","sent":"已下发","timeout":"超时"} ||
|>progress|进度|struct| ||
|>>percent|进度百分比|int||暂无精确进度，成功后为100%|



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"output": {
			"status": "in_progress",
			"progress": {
				"percent": 0
			},
		},
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp:": 1654070968655,
	"method": "wayline_upload_progress"
}
```

## 上报航线执行进度

**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** flighttask_progress

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|ext|扩展内容|struct|||
|>current_waypoint_index|当前执行到的航点数|int||
|>wayline_mission_state|航线任务状态|enum_int|{"0":"初始化状态","1":"不支持航线任务","2":"航线准备状态,可上传文件,可执行已有文件","3":"航线文件上传中","4":"触发开始命令，飞行器触发读航线等逻辑，还未开始任务，处于准备状态","5":"进入航线,到第一个航点","6":"航线执行","7":"航线中断，触发条件：1.用户主动暂停 2.飞控异常","8":"航线恢复","9":"航线结束"}||
|>flight_id|任务ID|text|||
|>wayline_id|当前在作业的航线ID|int|||
|status|任务状态|enum_string|{"canceled":"取消或终止","failed":"失败","in_progress":"执行中","ok":"执行成功","partially_done":"部分完成","paused":"暂停","rejected":"拒绝","sent":"已下发","timeout":"超时"}||
|progress|进度|struct|||
|>current_step|执行步骤|enum_int|{"18":"KMZ文件上传","25":"执行航线"}||
|>percent|进度值|int||赞无准确进度，完成后为100%|
|result|返回码|int|  |非 0 代表错误|


**Example:**

```json
{
  "data": {
    "ext": {
      "current_waypoint_index": 0,
      "flight_id": "222222",
      "wayline_mission_state": 5
    },
    "progress": {
      "current_step": 25,
      "percent": 10
    },
    "result": 0,
    "status": "in_progress"
  },
  "method": "flighttask_execute_pregress",
  "need_reply": 0,
  "bid": "e655c827-b07f-4ca7-a910-94652967812e",
  "tid": "e655c827-b07f-4ca7-a910-94652967812e"
}
```


 # Service

## 上传航线

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_prepare

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|flight_id|航线ID|text|||
|file|航线文件对象|struct|  ||
|»url|文件 URL|text|  ||


**Example:**
```json
{
  "tid":"00000000-0000-0000-0000-000000000000",
  "bid":"00000000-0000-0000-0000-000000000000",
  "timestamp":1234567890,
  "method":"flighttask_prepare",
  "data":{
    "flight_id":"222222",
    "file":{
      "url":"http://43.139.190.67:9090/1xzenemi85xy90iseqne/heishakmz/Waypoint2024-11-22-09-32-02.kmz"
    }
  },
  "gateway":"5YSZL8U0033CEY"
}

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_prepare

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "wayline_upload"
}
```

## 执行航线

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_execute

**Data:** 

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|flight_id|航线ID|text|||


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"flight_id": "222222"
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_execute"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_execute

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_execute"
}
```

## 停止航线

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_stop

**Data:** null 



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_stop"
}
```

**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_stop

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_stop"
}
```



## 航线恢复



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_recovery

**Data:** null 



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_recovery"
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_recovery

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"need_reply": 0,
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_recovery"
}
```


## 航线暂停



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_pause

**Data:** null 



**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {},
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_pause"
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_pause

**Data:**

|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|返回码|int|  |非 0 代表错误|


 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0
	},
	"need_reply": 0,
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_pause"
}
```




